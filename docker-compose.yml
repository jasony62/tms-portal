version: '3.7'
services:
  mongodb:
    build: ./mongodb
    image: tms-portal/mongodb:latest
    container_name: tms-portal-mongodb

  back:
    build: ./back
    image: tms-portal/back:latest
    container_name: tms-portal-back
    environment:
      # app 端口号
      # - TMS_APP_PORT=3000
      # app 名称
      # - TMS_APP_NAME=dev-op
      # reids 配置
      # - TMS_REDIS_PREFIX=dev
      # - TMS_REDIS_HOST=localhost
      # - TMS_REDIS_PORT=6378
      # mongodb配置
      # - TMS_MONGODB_USER_NAME=root
      # - TMS_MONGODB_USER_PWD=pmjswjkai
      # 库名配置
      # - TMS_CTRL_MONGODB_DATABASE=tms-portal
    command:
      ['sh', './wait-for.sh', 'psmongodb:27017', '-t', '300', '--', 'node', 'server']

  ue_admin:
    build: 
      context: ./ue_admin
      args:
        vue_app_login_key_username: username
        vue_app_login_key_password: password
        vue_app_login_key_pin: pin
        vue_app_base_url: /admin
        vue_app_auth_base: /auth
        vue_app_api_base: /api	
        vue_app_auth_disabled: No
        vue_app_storetoken_way: session
    image: tms-portal/ue_admin:latest
    container_name: tms-portal-ue_admin
    # environment:
    # - NGINX_BACK_BASE_URL=http://back:3000
    # - NGINX_WEB_BASE_URL=/admin
    # # 定义连接基数区域，10m 可以储存 320000 个并发会话
    # - NGINX_LIMIT_CONN_ZONE=10m
    # # 是限制每个IP只能发起8000个并发连接
    # - NGINX_LIMIT_CONN_CONNIP=8000
    # # 指定当触发limit的时候日志打印级别
    # - NGINX_LIMIT_CONN_LOG_LEVEL=error
    # # 回复被禁用的连接请求时的状态码
    # - NGINX_LIMIT_CONN_STATUS=503
    # # 达到阀值后开始限速(字节)
    # - NGINX_LIMIT_RATE_AFTER=300m
    # # 限制向客户端传输数据的速度(Byte/s)
    # - NGINX_LIMIT_RATE=300k
    # # 指定等待client发送一个包体的超时时间
    # - NGINX_CLIENT_BODY_TIMEOUT=60s
    # # 指定等待client发送一个包头的超时时间
    # - NGINX_CLIENT_HEADER_TIMEOUT=60s
    # # keep-alive连接超时时间
    # - NGINX_KEEPALIVE_TIMEOUT=75s
    # # 服务端向客户端传输数据的超时时间
    # - NGINX_SEND_TIMEOUT=60s
    # # 隐藏版本号
    # - NGINX_SERVER_TOKENS=off


  mongo:
    build: 
      context: ./ue_portal
      args:
        vue_app_login_key_username: username
        vue_app_login_key_password: password
        vue_app_login_key_pin: pin
        vue_app_base_url: /portal
        vue_app_auth_base: /auth
        vue_app_api_base: /api
        vue_app_auth_disabled: No
        vue_app_storetoken_way: session
    image: tms-portal/ue_portal:latest
    container_name: tms-portal-ue_portal
    # environment:
    # - NGINX_BACK_BASE_URL=http://back:3000
    # - NGINX_WEB_BASE_URL=/portal
    # # 定义连接基数区域，10m 可以储存 320000 个并发会话
    # - NGINX_LIMIT_CONN_ZONE=10m
    # # 是限制每个IP只能发起8000个并发连接
    # - NGINX_LIMIT_CONN_CONNIP=8000
    # # 指定当触发limit的时候日志打印级别
    # - NGINX_LIMIT_CONN_LOG_LEVEL=error
    # # 回复被禁用的连接请求时的状态码
    # - NGINX_LIMIT_CONN_STATUS=503
    # # 达到阀值后开始限速(字节)
    # - NGINX_LIMIT_RATE_AFTER=300m
    # # 限制向客户端传输数据的速度(Byte/s)
    # - NGINX_LIMIT_RATE=300k
    # # 指定等待client发送一个包体的超时时间
    # - NGINX_CLIENT_BODY_TIMEOUT=60s
    # # 指定等待client发送一个包头的超时时间
    # - NGINX_CLIENT_HEADER_TIMEOUT=60s
    # # keep-alive连接超时时间
    # - NGINX_KEEPALIVE_TIMEOUT=75s
    # # 服务端向客户端传输数据的超时时间
    # - NGINX_SEND_TIMEOUT=60s
    # # 隐藏版本号
    # - NGINX_SERVER_TOKENS=off

  
